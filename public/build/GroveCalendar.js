webpackJsonp([0],[function(e,exports,t){function n(e){i.findWhere(c,{id:e})||(c=c.concat({id:e,text:e}),s('select[name="focus_area"]').select2({data:c,tags:!0,allowClear:!0,width:"style"}))}function a(e,t){s("#add-event-text").text("   Add Event"),s('#activity-form select[name="activity"]').val(null),s('#activity-form select[name="focus_area"]').select2("val",null),t||s("#add-event").off("click"),e&&(s("#activity-form").hide("fast"),s("#calendar-button-container").show("fast"))}var i=t(1),s=(t(3),t(102));t(103),t(104),t(117);var o=[],c=i.chain(FOCUS_AREAS).keys().sortBy().value().map(function(e){return{id:e,text:e}}),r=function(e){this.googleId=e.googleId,this.name=e.name,this.image=e.image,this.calendar=e.groveCalendar||[],this.option=s("<option>"+e.name+"</option>").attr("value",e.googleId),this.optionRendered=!1,this.eventDisplays=i.map(e.groveCalendar,function(e,t){return new l(this,e,t)}.bind(this))||[]};r.prototype.renderOption=function(e){this.optionRendered||(s(e).append(this.option),this.optionRendered=!0)},r.prototype.renderEvents=function(e){i.each(this.eventDisplays,function(t){t.render(e),n(t.event.focus_area)})},r.prototype.updateSort=function(e,t){var n=this,a=s("#events-list").sortable("toArray",{attribute:"data-index"});a.forEach(function(e,t){e!=t&&(n.eventDisplays[e].index=t,s(n.eventDisplays[e].el).attr("data-index",t))}),this.eventDisplays=i.sortBy(this.eventDisplays,"index"),s("#save-calendar").removeClass("disabled").empty().append('<i class="fa fa-calendar"></i>   Save Grove Cycle')},r.prototype.renderCalendar=function(e){s("#student-name").text(this.name),s("#title-text").text("'s Grove Cycle"),s("#student-icon").empty().append('<img class="student-icon" src="'+this.image+'">'),a(!0,!1),s(e).empty(),this.renderEvents(e);var t=this;s("#calendar-container").show(),s("#events-list").sortable({stop:t.updateSort.bind(t)}),s("#create-new-event").off("click").on("click",function(e){s("#activity-legend").text("New event for: "+t.name),s("#activity-form").show("fast"),s("#add-event").on("click",function(e){e.preventDefault();var i={},o=s('#activity-form select[name="activity"]').val();i.location=o.split("#")[0],i.activity=o.split("#")[1];var c=t.eventDisplays.length,r=s('#activity-form select[name="focus_area"]').val();i.focus_area=r,n(r),i=new l(t,i,c),t.eventDisplays.push(i),i.render("#events-list"),a(!1,!0),s("#save-calendar").removeClass("disabled").empty().append('<i class="fa fa-calendar"></i>   Save Grove Cycle')}),s("#cancel-event-add").on("click",function(e){e.preventDefault(),a(!0)})}),s("#save-calendar").empty().append('<i class="fa fa-calendar"></i>   Save Grove Cycle').addClass("disabled"),s("#save-calendar").off("click").on("click",function(e){s("#save-calendar").empty().text("Saving...").addClass("disabled");var n=t.eventDisplays.map(function(e){return e.event.checkedIn=!1,e.event});s.ajax("/api/grove/"+t.googleId,{method:"PUT",data:JSON.stringify({calendar:n}),contentType:"application/json",success:function(){s("#save-calendar").empty().append('<i class="fa fa-calendar"></i>   Cycle Saved!')},error:function(e,t,n){s("#save-calendar").empty().removeClass("btn-success").addClass("btn-danger").text("Error Saving").removeClass("disabled")}})})};var l=function(e,t,n){this.student=e,this.event=t,this.index=n,this.el=this.createDisplay()};l.prototype.createDisplay=function(){var e="<tr></tr>",t=s("<td></td>").text(this.event.location),n=s("<td></td>").text(this.event.activity),a=s("<td></td>").text(this.event.focus_area),i="<td></td>";this.editButton=s('<button class="btn btn-xs btn-info"><i class="fa fa-pencil"></i></button>'),i=s(i).append(this.editButton);var o="<td></td>";return this.removeButton=s('<button class="btn btn-xs btn-danger"><i class="fa fa-times"></i></button>'),o=s(o).append(this.removeButton),s(e).attr("data-index",this.index).append(t,n,a,i,o)[0]},l.prototype.render=function(e,t){var i=this;if(t){var o=i.el;i.el=i.createDisplay(),s(o).replaceWith(i.el)}else s(e).append(this.el);s(this.editButton).click(function(e){s('#activity-form select[name="activity"]').val(i.event.location+"#"+i.event.activity),s('#activity-form select[name="focus_area"]').select2("val",i.event.focus_area),s("#add-event-text").text("   Save"),s("#activity-form").show("fast",function(){s("#add-event").off("click").one("click",function(e){e.preventDefault();var t=s('#activity-form select[name="activity"]').val();t?(i.event.location=t.split("#")[0],i.event.activity=t.split("#")[1]):(i.event.location="",i.event.activity="");var o=s('#activity-form select[name="focus_area"]').val();i.event.focus_area=o,n(o),a(!0),i.render("#events-list",!0),s("#save-calendar").removeClass("disabled")}),s("#cancel-event-add").on("click",function(e){e.preventDefault(),a(!0)})})}),s(this.removeButton).click(function(e){s(i.el).remove(),i.student.eventDisplays.splice(i.index,1),i.student.eventDisplays.forEach(function(e){e.index>i.index&&e.index--}),a(!0)})},s(function(){i.keys(GROVE_ACTIVITIES).forEach(function(e){var t=s("<optgroup>").attr("label",e);GROVE_ACTIVITIES[e].forEach(function(n){var a=s("<option>").attr("value",[e,n].join("#")).text(n);t.append(a)}),s('select[name="activity"]').append(t)}),s('select[name="focus_area"]').css("width","100%").select2({data:c,tags:!0,width:"style"}),s.get("/api/grove",function(e){o=i.map(i.sortBy(e,"name"),function(e){return student=new r(e),student.renderOption("#student-names-select"),student}),s("#student-names-select").on("change",function(e){var t=i.find(o,{googleId:e.target.value});t.renderCalendar("#events-list")}),s("#student-name-search").on("keyup",function(e){s("#student-names-select").css("visibility","");var t=s(this).val().toLowerCase();i.each(o,function(e){e.name.toLowerCase().match(t)?e.renderOption("#student-names-select"):(s(e.option).remove(),e.optionRendered=!1)}),1===s("#student-names-select option").length&&s("#student-names-select").trigger("change")})})})}]);